<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>সদস্য ড্যাশবোর্ড</title>
<link rel="icon" href="favicon.png" sizes="180x180">
<style>
  body {
    font-family: Arial, sans-serif;
    padding: 20px;
    background: linear-gradient(to bottom, #a8e6cf, #dcedc1);
    min-height: 100vh;
  }
  .background {
    background-image: url('favicon.png');
    background-size: 200px 200px;
    background-repeat: no-repeat;
    background-position: center;
    opacity: 0.05;
    position: fixed; top: 0; left: 0; right: 0; bottom: 0; z-index: -1;
  }
  h1 {
    text-align: center;
    margin-bottom: 5px;
    color: #264653;
    font-size: 2.8rem;
    text-shadow: 2px 2px 6px rgba(0,0,0,0.1);
  }
  #memberName {
    text-align: center;
    margin-bottom: 25px;
    font-size: 1.5rem;
    color: #2a9d8f;
    font-weight: bold;
  }
  table {
    width: 90%;
    margin: 20px auto;
    border-collapse: collapse;
    background: white;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    border-radius: 10px;
    overflow: hidden;
  }
  th, td {
    border: 1px solid #ddd;
    padding: 12px;
    text-align: center;
  }
  th {
    background: #007bff;
    color: white;
    font-size: 1.1rem;
  }
  #logoutBtn {
    float: right;
    margin-right: 5%;
    padding: 10px 18px;
    background: red;
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-size: 1rem;
    box-shadow: 0 2px 6px rgba(0,0,0,0.2);
  }
  #logoutBtn:hover { background: darkred; }
  @media (max-width: 768px){
    h1 { font-size: 2rem; }
    #memberName { font-size: 1.2rem; }
    table { width: 95%; }
    #logoutBtn { padding: 8px 15px; font-size: 0.9rem; }
  }
   #excelfile {
    float: left;
    margin-left: 5%;
    padding: 10px 18px;
    background: red;
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-size: 1rem;
    box-shadow: 0 2px 6px rgba(0,0,0,0.2);
  }
  #excelfile:hover { background: darkred; }
      #excelfile { padding: 8px 15px; font-size: 0.9rem; }
  
</style>
</head>
<body>

<div class="background"></div>

<h1>সদস্য ড্যাশবোর্ড</h1>
<div id="memberName"></div>
<button id="logoutBtn">লগআউট</button>
<button id="excelfile" onclick="window.location.href='https://1drv.ms/f/c/920544377a6755f3/ElmgEem2iq1BpS8iaCmu2MABuZRphS_LzTgV5zJVrUOA4w'">এক্সেল ফাইল</button>

<table>
<thead>
<tr>
<th>মাস / ইভেন্ট</th>
<th>পরিমাণ</th>
</tr>
</thead>
<tbody id="contributionsBody"></tbody>
</table>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-auth.js";
import { getFirestore, doc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-firestore.js";

// Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyC63JYlboedK6hE_u4ubAT0Nm2PIo-ygQk",
  authDomain: "atmoshuddi.firebaseapp.com",
  projectId: "atmoshuddi",
  storageBucket: "atmoshuddi.firebasestorage.app",
  messagingSenderId: "540869594984",
  appId: "1:540869594984:web:667a69b95b6edd983ed0dd",
  measurementId: "G-X9HQ1DN4P7"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const tableBody = document.getElementById("contributionsBody");
const memberNameDiv = document.getElementById("memberName");

document.getElementById("logoutBtn").addEventListener("click", () => {
  signOut(auth).then(() => window.location.href="/member.html");
});

// Display name from localStorage (selected in member.html)
const selectedName = localStorage.getItem("memberName") || "";
memberNameDiv.textContent = selectedName;

onAuthStateChanged(auth, user => {
  if(user){
    const memberDoc = doc(db, "members", user.uid);
    onSnapshot(memberDoc, docSnap => {
      if(docSnap.exists()){
        const data = docSnap.data();
        const contributions = data.contributions || [];
        tableBody.innerHTML = "";
        let total = 0;
        contributions.forEach(item => {
          const tr = document.createElement("tr");
          const tdMonth = document.createElement("td");
          tdMonth.textContent = item.month;
          const tdAmount = document.createElement("td");
          tdAmount.textContent = item.amount;
          tr.appendChild(tdMonth);
          tr.appendChild(tdAmount);
          tableBody.appendChild(tr);
          total += item.amount;
        });
        // Total row
        const trTotal = document.createElement("tr");
        const tdLabel = document.createElement("td");
        tdLabel.textContent = "মোট";
        tdLabel.style.fontWeight = "bold";
        const tdTotal = document.createElement("td");
        tdTotal.textContent = total;
        tdTotal.style.fontWeight = "bold";
        trTotal.appendChild(tdLabel);
        trTotal.appendChild(tdTotal);
        tableBody.appendChild(trTotal);
      }
    });
  } else {
    window.location.href="/member.html";
  }
});
</script>

</body>
</html>
